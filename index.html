<script>
    let coins = 0; // Текущие монеты игрока
    let tokens = 0; // Текущие токены игрока
    let rocketLevel = 0; // Случайный уровень полёта ракеты

    // Начисление 10 монет при заходе
    function addInitialCoins() {
        coins += 10; // Добавляем 10 монет
        alert("Вы получили 10 монет за вход!"); // Уведомление
        updateUI();
    }

    // Смена фона в зависимости от высоты
    function updateBackground(level) {
        if (level <= 30) {
            document.body.style.background = "linear-gradient(to bottom, #87ceeb, #f0f8ff)"; // Небо
        } else if (level <= 60) {
            document.body.style.background = "linear-gradient(to bottom, #1e3c72, #2a5298)"; // Космос
        } else if (level <= 80) {
            document.body.style.background = "linear-gradient(to bottom, #000000, #1e3c72)"; // Звёзды
        } else {
            document.body.style.background = "linear-gradient(to bottom, #000000, #ffffff)"; // Луна
        }
    }

    // Функция для генерации числа с более частым выпадением маленьких значений
    function generateRocketLevel() {
        const weights = [];
        for (let i = 1; i <= 100; i++) {
            weights.push(1 / Math.pow(i, 2)); // Чем больше число, тем меньше вероятность
        }
        const totalWeight = weights.reduce((a, b) => a + b, 0);
        const random = Math.random() * totalWeight;
        let cumulativeWeight = 0;
        for (let i = 1; i <= 100; i++) {
            cumulativeWeight += weights[i - 1];
            if (random <= cumulativeWeight) return i;
        }
        return 100; // На случай ошибки
    }

    // Анимация ракеты и смена фона
    function animateRocket(level, callback) {
        const rocket = document.getElementById("rocket");
        const flame = document.getElementById("flame");
        const containerHeight = document.getElementById("rocket-container").offsetHeight;
        const targetPosition = (level / 100) * containerHeight;

        let currentPosition = 0;
        flame.style.display = "block"; // Показываем пламя
        const interval = setInterval(() => {
            currentPosition += 5;
            rocket.style.bottom = `${currentPosition}px`;
            flame.style.bottom = `${currentPosition - 20}px`;
            updateBackground(level); // Обновляем фон
            if (currentPosition >= targetPosition) {
                clearInterval(interval);
                flame.style.display = "none"; // Скрываем пламя
                callback();
            }
        }, 50);
    }

    // Функция для обновления интерфейса
    function updateUI() {
        document.getElementById("game-status").textContent = coins;
        document.getElementById("token-status").textContent = tokens;
    }

    // Функция для размещения ставки
    function placeBet() {
        const betCoinsInput = document.getElementById("bet-coins-input");
        const betLevelInput = document.getElementById("bet-level-input");
        const betCoins = parseInt(betCoinsInput.value);
        const betLevel = parseInt(betLevelInput.value);

        if (!betCoins || betCoins <= 0) {
            alert("Введите корректную сумму ставки.");
            return;
        }

        if (!betLevel || betLevel < 1 || betLevel > 100) {
            alert("Введите уровень от 1 до 100.");
            return;
        }

        if (betCoins > coins) {
            alert("Недостаточно монет для этой ставки.");
            return;
        }

        // Списываем монеты за ставку
        coins -= betCoins;

        // Генерируем уровень полёта ракеты
        rocketLevel = generateRocketLevel();

        // Запускаем анимацию ракеты
        animateRocket(rocketLevel, () => {
            if (rocketLevel >= betLevel) {
                const tokensWon = betCoins * betLevel; // Выигрыш в токенах
                tokens += tokensWon;
                alert(`Ракета долетела до уровня ${rocketLevel}. Вы выиграли ${tokensWon} токенов!`);
            } else {
                alert(`Ракета долетела до уровня ${rocketLevel}. Вы проиграли.`);
            }

            updateUI();
        });
    }

    // Вызываем начисление 10 монет при загрузке страницы
    window.onload = addInitialCoins;
</script>
